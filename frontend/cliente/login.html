<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login do Cliente | Fotos do Tap.</title>
  <link rel="icon" href="https://static.fotosdotap.com.br/assets/logo.svg" type="image/svg+xml">
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Text:ital@0;1&family=Open+Sans:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://static.fotosdotap.com.br/css/style.css" />
  <link rel="stylesheet" href="https://static.fotosdotap.com.br/css/components/button.css" />
  <meta name="description" content="√Årea de acesso para clientes Fotos do Tap. Use seu e-mail para acessar suas fotos." />
  <meta property="og:title" content="Login do Cliente | Fotos do Tap." />
  <meta property="og:description" content="√Årea de acesso para clientes Fotos do Tap. Use seu e-mail para acessar suas fotos." />
  <meta property="og:image" content="https://static.fotosdotap.com.br/assets/og_image.jpg" />
  <meta property="og:url" content="https://seusite.com/login.html" />
  <meta property="og:type" content="website" />
  <meta name="twitter:image" content="https://static.fotosdotap.com.br/assets/og_image.jpg" />
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header__container">
      <a href="https://fotosdotap.com.br" class="header__logo" aria-label="Voltar para p√°gina inicial">
        <img class="header__logo-img" src="https://static.fotosdotap.com.br/assets/logo.svg" alt="Logo Fotos do Tap" />
        <span>Fotos do Tap.</span>
      </a>
      <!-- Menu removido para ambiente isolado do cliente -->
    </div>
  </header>

  <!-- Main com login -->
  <main class="main" data-fade>
    <section class="container" aria-label="Login do Cliente" style="text-align: center; padding: 2rem 1rem;">
      <h2 class="hero hero__title" data-fade>√Årea do Cliente</h2>
      <form id="form-login" style="max-width: 400px; margin: 0 auto;">
        <div id="etapa-email">
          <input
            type="email"
            id="email"
            name="email"
            placeholder="Seu e-mail"
            required
            style="width: 100%; padding: 0.75rem; font-size: 1rem; border: 1px solid #ccc; border-radius: 0.5rem;"
          />
          <button type="button" id="btn-verificar-email" class="btn-base" style="margin-top: 1rem;">Avan√ßar</button>
        </div>
        <div id="etapa-senha" style="display:none;">
          <input
            type="password"
            id="senha"
            name="senha"
            placeholder="Digite sua senha"
            required
            style="width: 100%; padding: 0.75rem; font-size: 1rem; border: 1px solid #ccc; border-radius: 0.5rem;"
          />
          <button type="submit" class="btn-base" style="margin-top: 1rem;">Entrar</button>
        </div>
        <div id="etapa-cadastrar-senha" style="display:none;">
          <input
            type="password"
            id="nova-senha"
            name="nova-senha"
            placeholder="Cadastre uma senha"
            required
            style="width: 100%; padding: 0.75rem; font-size: 1rem; border: 1px solid #ccc; border-radius: 0.5rem;"
          />
          <button type="button" id="btn-cadastrar-senha" class="btn-base" style="margin-top: 1rem;">Cadastrar senha</button>
        </div>
        <p id="mensagem-erro" style="color: red; margin-top: 1rem; display: none;"></p>
      </form>
    </section>
  </main>

  <div style="height: var(--espacamento-div);"></div>

  <!-- Footer -->
  <footer class="footer" data-fade>
    <!-- Rodap√© simplificado para ambiente do cliente -->
    <nav class="footer__nav" aria-label="Menu do rodap√©">
      <ul class="footer__list">
        <li class="footer__item"><a href="https://fotosdotap.com.br" class="footer__link">Voltar ao site principal</a></li>
      </ul>
    </nav>
    <p class="footer__text">&copy; 2025 ‚Ä¢ Feito com carinho e criatividade por Tapejara Lira. Todos os direitos reservados.</p>
  </footer>

  <!-- Scripts padr√£o -->
  <script src="https://static.fotosdotap.com.br/js/menu.js"></script>
  <script src="https://static.fotosdotap.com.br/js/pageFade.js"></script>
  <script>
    const apiBase = '/api'; // ajuste se necess√°rio
    const form = document.getElementById('form-login');
    const etapaEmail = document.getElementById('etapa-email');
    const etapaSenha = document.getElementById('etapa-senha');
    const etapaCadastrarSenha = document.getElementById('etapa-cadastrar-senha');
    const mensagemErro = document.getElementById('mensagem-erro');
    let emailAtual = '';

    document.getElementById('btn-verificar-email').onclick = async function () {
      mensagemErro.style.display = 'none';
      const email = document.getElementById('email').value.trim();
      // Valida√ß√£o de formato de e-mail
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        mensagemErro.textContent = 'Ops! Parece que esse e-mail n√£o est√° certinho. D√° uma olhadinha üòâ';
        mensagemErro.style.display = 'block';
        return;
      }
      if (!email) return;
      // Verifica se o e-mail existe e se j√° tem senha
      try {
        const res = await fetch(`${apiBase}/login?email=${encodeURIComponent(email)}`);
        const data = await res.json();
        if (data.estado === 'nao_encontrado') {
          mensagemErro.textContent = 'Hmm... n√£o encontramos esse e-mail por aqui. Que tal tentar outro?';
          mensagemErro.style.display = 'block';
        } else if (data.senhaCadastrada) {
          emailAtual = email;
          etapaEmail.style.display = 'none';
          etapaSenha.style.display = 'block';
        } else {
          emailAtual = email;
          etapaEmail.style.display = 'none';
          etapaCadastrarSenha.style.display = 'block';
        }
      } catch (e) {
        mensagemErro.textContent = 'Ih, parece que estamos com um probleminha na conex√£o. Tenta de novo em instantes!';
        mensagemErro.style.display = 'block';
      }
    };

    // Login com senha
    form.onsubmit = async function (e) {
      if (etapaSenha.style.display !== 'block') return;
      e.preventDefault();
      mensagemErro.style.display = 'none';
      const senha = document.getElementById('senha').value;
      try {
        const res = await fetch(`${apiBase}/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email: emailAtual, senha })
        });
        const data = await res.json();
        if (data.sucesso) {
          window.location.href = `/cliente/${encodeURIComponent(emailAtual)}/index.html`;
        } else {
          mensagemErro.textContent = data.erro || 'Senha errada! N√£o desista, tente de novo üòâ';
          mensagemErro.style.display = 'block';
        }
      } catch (e) {
        mensagemErro.textContent = 'Ih, parece que estamos com um probleminha na conex√£o. Tenta de novo em instantes!';
        mensagemErro.style.display = 'block';
      }
    };

    // Cadastro de nova senha
    document.getElementById('btn-cadastrar-senha').onclick = async function () {
      mensagemErro.style.display = 'none';
      const novaSenha = document.getElementById('nova-senha').value;
      if (!novaSenha) return;
      try {
        const res = await fetch(`${apiBase}/cadastrarSenha`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email: emailAtual, senha: novaSenha })
        });
        const data = await res.json();
        if (data.sucesso) {
          window.location.href = `/cliente/${encodeURIComponent(emailAtual)}/index.html`;
        } else {
          mensagemErro.textContent = data.erro || 'N√£o foi dessa vez... Mas n√£o desanime! Tente cadastrar sua senha novamente.';
          mensagemErro.style.display = 'block';
        }
      } catch (e) {
        mensagemErro.textContent = 'Ih, parece que estamos com um probleminha na conex√£o. Tenta de novo em instantes!';
        mensagemErro.style.display = 'block';
      }
    };
  </script>
</body>
</html>
